version: '2'

services:
    es_admin_nginx:
        command: nginx -c /docker/nginx.conf
        container_name: es_admin_nginx
        image: nginx
        links:
            - es_admin_php:es_admin_php
        ports:
            - 80:80
        volumes:
            - ./docker/nginx/nginx.conf:/nginx.conf
            - ./docker/nginx/log:/var/log/nginx
            - .:/var/www/html

    es_admin_php:
        build:
            context: ./docker/php
        container_name: es_admin_php
        image: es_admin_php
        links:
            - es_admin_elasticsearch:es_admin_elasticsearch
        ports:
            - 9000:9000
        volumes:
            - .:/var/www/html

    #docker run --name elasticsearch -p 9200:9200 -p 9300:9300 -e "cluster.name=elasticsearch" -e "discovery.type=single-node" -e "node.name=docker" -e "http.cors.enabled=true" -e "http.cors.allow-origin=*" -e "http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization" -e "http.cors.allow-credentials=true" docker.elastic.co/elasticsearch/elasticsearch:7.8.0
    es_admin_elasticsearch:
        container_name: es_admin_elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:7.8.0
        environment:
            - cluster.name=elasticsearch
            - node.name=docker
            - xpack.security.enabled=false
            - discovery.type=single-node
            - http.cors.enabled=true
            - http.cors.allow-origin="*"
            - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization
            - http.cors.allow-credentials=true
            #- bootstrap.memory_lock=true
            #- "ES_JAVA_OPTS=-Xms512m -Xmx512m"
        ulimits:
            memlock:
                soft: -1
                hard: -1
            nofile:
                soft: 65536
                hard: 65536
        mem_limit: 1g
        cap_add:
            - IPC_LOCK
        ports:
            - 9200:9200
            - 9300:9300

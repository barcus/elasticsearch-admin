{% embed 'Embed/table_embed.html.twig' %}
    {% import 'Import/app_import.html.twig' as appImport %}

    {% set columns = {'name': true, 'index_patterns': true, 'priority': true, 'version': true, 'composed_of': true, 'description': true} %}

    {% set is_granted_component_templates = is_granted('COMPONENT_TEMPLATES', 'global') %}

    {% block thead %}
        <tr>
            {% for column, display in columns %}
                {% if true == display %}
                    {% if 'name' == column %}
                        <th>
                            {{ 'name'|trans }}{{ appImport.badge({'title': 'sort_asc'|trans, 'context': 'light'}) }}
                        </th>
                    {% endif %}

                    {% if 'index_patterns' == column %}
                        <th>
                            {{ 'index_patterns'|trans }}
                        </th>
                    {% endif %}

                    {% if 'priority' == column %}
                        <th>
                            {{ 'priority'|trans }}
                        </th>
                    {% endif %}

                    {% if 'version' == column %}
                        <th class="d-none d-xl-table-cell">
                            {{ 'version'|trans }}
                        </th>
                    {% endif %}

                    {% if 'composed_of' == column %}
                        <th>
                            {{ 'composed_of'|trans }}
                        </th>
                    {% endif %}

                    {% if 'description' == column %}
                        <th class="d-none d-xl-table-cell">
                            {{ 'description'|trans }}
                        </th>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </tr>
    {% endblock %}

    {% block tbody %}
        {% for row in templates.rows %}
            <tr>
                {% for column, display in columns %}
                    {% if true == display %}
                        {% if 'name' == column %}
                            <td>
                                <a href="{{ path('index_templates_read', {'name': row.name}) }}">{{ row.name }}</a>
                            </td>
                        {% endif %}

                        {% if 'index_patterns' == column %}
                            <td>
                                {{ row.indexPatterns|join(', ')|replace({'[': '', ']': ''}) }}
                            </td>
                        {% endif %}

                        {% if 'priority' == column %}
                            <td>
                                {% if row.priority %}
                                    {{ row.priority }}
                                {% endif %}
                            </td>
                        {% endif %}

                        {% if 'version' == column %}
                            <td class="d-none d-xl-table-cell">
                                {% if row.version %}
                                    {{ row.version }}
                                {% endif %}
                            </td>
                        {% endif %}

                        {% if 'composed_of' == column %}
                            <td>
                                {% if row.composedOf %}
                                    {% for componentTemplate in row.composedOf %}
                                        {% if is_granted_component_templates %}
                                            <a class="text-secondary" href="{{ path('component_templates_read', {'name': componentTemplate}) }}">{{ componentTemplate }}</a>
                                        {% else %}
                                            {{ componentTemplate }}
                                        {% endif %}
                                        {% if false == loop.last %}, {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </td>
                        {% endif %}

                        {% if 'description' == column %}
                            <td class="d-none d-xl-table-cell">
                                {% if row.metadata and row.metadata.description is defined %}
                                    {{ row.metadata.description }}
                                {% endif %}
                            </td>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
    {% endblock %}
{% endembed %}
